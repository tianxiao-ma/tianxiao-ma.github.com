---
title: Java 软引用、弱引用和影子引用
layout: post
permalink: /2013/10/Java-Soft-Weak-Phantom-Reference
date: Fri Oct 19 14:45:56 pm GMT+8 2013
published: true
---

SoftReference
=======
被`SoftReference`引用的对象，会在JVM发现内存不足的时候被清理掉，JVM保证在抛出`OutOfMemoryError`之前所有只能通过软引用被访问到的对象都会被垃圾回收掉。	

软引用对于内存缓存的实现比较有用，当内存不足的时候，那些只能通过软引用才能被访问到的缓存对象将会被清理掉，从而释放出可用的内存空间。

当一个软引用的`referent`(被引用的那个对象)被清理的时候，这个软引用会被放到`ReferenceQueue`中(如果这样的`ReferenceQueue`存在的话)，应用程序可以通过这种方式知道一个软引用对象被清理掉了。我们可以通过软引用的`get`方法拿到被应用的对象，如果被引用的对象还没有被清理掉，那么就可以重新激活这个对象，让这个对象重新生存下去。

WeakReference
======
被`WeakReference`引用的对象，当JVM发现这个对象只能通过弱引用访问到的时候，就会将这个对象标记成可回收状态，垃圾收集器就会在适当的时候回收这个对象，并释放被占用的内存空间。

当一个弱引用的`referent`(被引用的那个对象)被标记成可回收状态的时候，这个弱引用会被放到`ReferenceQueue`中(如果这样的`ReferenceQueue`存在的话)，应用程序可以通过这种方式知道一个弱引用对象将会被清理掉了。我们可以通过软引用的`get`方法拿到被应用的对象，如果被引用的对象还没有被清理掉，那么就可以重新激活这个对象，让这个对象重新生存下去。

弱引用一般被用作映射表的key或者value，这样就允许这些key或者value被垃圾收集器回收。当一个映射表中的key或者value只在应用或者系统运行的某个阶段被使用或者使用频率非常低，而且占用的内存资源又比较多，那么就可以使用弱引用。这样，这些只使用一次或者不经常使用的对象就可以被JVM回收掉，从而释放其占有的资源。

PhantomReference
======
影子引用一般只会用作一个对象将要被回收的通知机制。当被`PhantomReference`引用的对象处在可回收状态时，影子引用会被放到`ReferenceQueue`中，应用程序可以通过这种方式知道一个对象将要会回收，从而执行一些清理任务。这个机制比使用finalizer来做释放前清理任务要更加灵活一些。

一旦一个影子引用被放到`ReferenceQueue`中，就说明其`referent`已经处在被回收的状态了，JVM将不会允许重新激活这个对象，因此影子引用的`get`方法总是会null。与弱引用和软引用不同的是，垃圾收集器并不会自动清理影子引用的`referent`，只有指向`referent`的影子引用对象本身也可以被回收的时候，`referent`才会被真正清理掉。